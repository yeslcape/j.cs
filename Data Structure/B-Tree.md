# B-Tree
![](https://velog.velcdn.com/images/chanyoung1998/post/71081810-5f66-4c85-b844-f716070b7ae8/image.png)

### 개념
데이터베이스와 파일 시스템에서 널리 사용되는 트리 자료구조의 일종
이진 트리를 확장해 하나의 노드가 가질 수 있는 자식 노드의 최대 숫자가 2보다 큰 트리 구조

### 특징
* 노드에는 항상 정렬된 상태의 2개 이상의 데이터(key) 저장
* 내부 노드는 ceil(M/2) ~ M개의 자식을 가질 수 있음
  * 최대 M개의 자식을 가질 수 있는 B 트리 = M차 B트리
* 특정 노드의 데이터(key)가 K개라면, 자식 노드의 개수는 K+1개
* 특정 노드의 왼쪽 서브 트리는 특정 노드의 key 보다 작은 값들로, 오른쪽 서브 트리는 큰 값들로 구성
* 노드 내에 데이터는 ceil(M/2)-1개부터 최대 M-1개까지 포함
  * 리프 노드의 데이터 수는 M보다 작음
* 모든 리프 노드들은 같은 레벨에 존재

### 탐색
* 루트 노드에서부터 하향식으로 탐색
* 자식 노드의 데이터는 부모 노드의 데이터에 따라 오름차순으로 배치
* 대소비교를 통해 값을 찾을 때까지 하향하며 탐색
  * 리프 노드에서도 값을 찾지 못한다면 트리에 값 미존재                               

### 삽입
* 리프노드에서부터 상향식으로 탐색
* 데이터를 넣을 적절한 리프 노드를 탐색하여 노드에 삽입
  * 리프 노드의 데이터 수는 M보다 작다를 만족시켜야 함
  * 노드에 들어있는 데이터 수가 M-2 이하라면 삽입
  * M-1이라면 해당 값을 부모 노드에 올리고, 그 자식 노드들을 새로 분리
    * B-tree의 조건을 만족할 때까지 재귀적으로 수행

### 삭제
cf) inorder predecessor : 노드의 왼쪽 자손에서 가장 큰 키
    inorder successor : 노드의 오른쪽 자손에서 가장 작은 키
* 조건
  * 루트 노드와 리프 노드를 제외한 노드는 2개 이상의 자식을 가져야 함
  * 각 노드는 M/2 ~ M-1개의 데이터 가짐
  * 각 노드의 데이터 수가 K라면, 자식 노드의 수는 K+1
1. 삭제할 k가 리프에 있는 경우
  1-1 현재 노드의 키 개수가 최소 키 개수보다 클 경우
   * 다른 노드들에 영향 없이 해당 k 단순 삭제
  1-2. 왼쪽 또는 오른쪽 형제 노드의 키가 최소 키 개수 이상일 경우
   * 부모 키 값으로 k 대체 
   * 최소 키 개수 이상의 키를 가진 형제 노드가 왼쪽 형제라면 가장 큰 값을, 오른쪽 형제라면 가장 작은 값을 부모 키로 대체
  1-3. 왼쪽, 오른쪽 형제 노드의 키가 최소 키 개수이고, 부모노드의 키가 최소 개수 이상일 경우
   * k를 삭제한 후, 부모 키를 형제 노드와 병합
   * 부모노드의 키 개수를 하나 줄이고, 자식 수 역시 하나 줄이기
  1-4. 자신과 형제, 부모 노드의 키 개수가 모두 최소 키 개수일 경우
   * 재구조화 과정.. -> case 3-2 과정
2. 삭제할 k가 내부 노드에 있고, 노드나 자식 키가 최소 키 수보다 많을 경우
  * 현재 노드의 inorder predecessor 또는 inorder successor와 k의 자리 바꾸기
  * 리프노드의 k를 삭제하게 되면 case 1으로 이동 
3. 삭제할 k가 내부 노드에 있고, 노드에 키 개수가 최소 키 개수만큼, 노드의 자식 키 개수도 모두 최소 키 개수인 경우
  * k를 삭제하면 트리의 높이가 줄어들어 재구조화가 일어나는 케이스
  3-1. k를 삭제하고, k의 양쪽 자식을 병합하여 하나의 노드로 만듦
  3-2. k의 부모 키를 인접한 형제 노드에 붙임. 이전에 병합했던 노드를 자식 노드로 설정
  3-3. 부모 노드의 개수에 따라 수행 과정 달라짐
    3-3-1. 새로 구성한 인접 형제노드의 키가 최대 키 개수를 넘어가면, 삽입 연산의 노드 분할 과정 수행
    3-3-2. 인접 형제노드가 새로 구성되더라도 원래 k의 부모 노드가 최소 키의 개수보다 작아지면, 부모 노드에 대하여 3-2 다시 수행


<br><br><br>
Reference
- https://ko.wikipedia.org/wiki/B_%ED%8A%B8%EB%A6%AC
- https://velog.io/@chanyoung1998/B%ED%8A%B8%EB%A6%AC
- https://code-lab1.tistory.com/217
- https://velog.io/@emplam27/%EC%9E%90%EB%A3%8C%EA%B5%AC%EC%A1%B0-%EA%B7%B8%EB%A6%BC%EC%9C%BC%EB%A1%9C-%EC%95%8C%EC%95%84%EB%B3%B4%EB%8A%94-B-Tree (삽입삭제 참고)